<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PROJECT FUSION — Flowchart</title>

<!-- html2canvas for PNG export -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* ==== THEME ==== */
/*
 * To evoke the sun‑drenched vibe of Destiny Island, the dark cyberpunk palette
 * has been replaced with a warm, tropical set of colours.  The base
 * background now fades from sky to sea, panels look like sandy islands and
 * accents pull from lush greens.  Keeping variables at the top makes it
 * simple to tweak the atmosphere without hunting through the stylesheet.
 */
:root{
  /* soft gradient for the page: sky to sea */
  --bg: linear-gradient(180deg, #bdefff 0%, #aeeafc 40%, #8bd4f7 100%);
  /* island panels: light sand to golden sand */
  --panel:#fff5c8;
  --panel-2:#ffe8a8;
  /* lush accents for highlights and links */
  --accent:#54c571;
  --accent-2:#79d08c;
  /* legible dark text and subdued secondary text */
  --text:#2f4858;
  --muted:#5f6e8a;
  /* rope‑like stroke colour for connectors */
  --stroke:#8cc8d4;
  /* softer drop shadow to mimic floating islands */
  --shadow:0 10px 24px rgba(0,0,0,.2),0 4px 12px rgba(0,0,0,.15);
  /* generous corner radius */
  --radius:20px;
}
html,body{height:100%}
body{
  margin:0;
  /* mix an underlying radial pattern with our tropical gradient */
  background:
    radial-gradient(1200px 800px at 20% 10%, rgba(255,255,255,.15) 0%, rgba(255,255,255,0) 80%),
    var(--bg);
  color:var(--text);
  font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  overflow:hidden;
}
/* ==== UI ==== */
.toolbar{
  position:fixed;
  inset:16px 16px auto auto;
  z-index:50;
  display:flex;
  gap:8px;
  align-items:center;
  background:rgba(255,255,255,.65);
  backdrop-filter:saturate(120%) blur(8px);
  border:1px solid rgba(0,0,0,.1);
  padding:8px 12px;
  border-radius:14px;
  box-shadow:var(--shadow);
}
.toolbar button{
  background:rgba(255,255,255,.9);
  color:var(--text);
  border:1px solid rgba(0,0,0,.1);
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition:.2s ease;
  letter-spacing:.2px;
  box-shadow:0 2px 4px rgba(0,0,0,.05);
}
.toolbar button:hover{
  transform:translateY(-1px);
  background:rgba(255,255,255,1);
}
.toolbar .hint{
  color:var(--muted);
  font-size:12px;
  padding-left:6px;
}

.viewport{position:fixed; inset:0}
.canvas{position:absolute; inset:0; transform-origin:0 0; touch-action:none}
/* animate canvas transforms for smooth zoom/pan and reset */
.canvas{
  transition:transform .4s ease;
}

.grid{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  top:120px;
  width:min(1000px, 92vw);
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));
  grid-gap:40px;
  padding-bottom:160px;
}
.node{
  /* give every island an irregular silhouette and sandy gradient */
  background:linear-gradient(145deg,var(--panel),var(--panel-2));
  border:2px solid rgba(0,0,0,.1);
  border-radius:0;
  box-shadow:var(--shadow);
  padding:20px 22px;
  position:relative;
  isolation:isolate;
  /* irregular island shape */
  clip-path:polygon(50% 0%, 88% 12%, 100% 42%, 86% 90%, 50% 100%, 18% 92%, 0% 60%, 4% 28%);
  /* subtle water ring around each island */
  overflow:visible;
}
/*
 * Assign a handful of unique island silhouettes.  These classes are added
 * dynamically to each category node (see JavaScript) to break up
 * repetition and reinforce the fantasy‑archipelago feel.  Feel free to
 * tweak the polygon points to make shapes more jagged or round.
 */
.island-0{clip-path:polygon(50% 0%,85% 8%,100% 40%,90% 90%,50% 100%,10% 90%,0% 60%,5% 20%)}
.island-1{clip-path:polygon(45% 0%,80% 20%,95% 50%,85% 95%,50% 100%,15% 95%,0% 60%,10% 20%)}
.island-2{clip-path:polygon(50% 0%,75% 10%,100% 35%,90% 80%,60% 100%,20% 95%,0% 65%,5% 25%)}
.island-3{clip-path:polygon(50% 0%,90% 20%,100% 55%,80% 100%,50% 95%,15% 100%,0% 60%,10% 20%)}
/* restore circular corners on nested elements */
.node .badge,
.node .chip,
.node .toggle{
  border-radius:999px;
}
.node.center{
  position:absolute;
  left:50%;
  top:16px;
  transform:translate(-50%,0);
  display:inline-flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  padding:30px 36px;
  /* centre island has its own silhouette */
  clip-path:polygon(50% 0%, 100% 35%, 88% 100%, 12% 100%, 0% 35%);
  border-radius:0;
  border:3px solid rgba(0,0,0,.15);
  background:linear-gradient(145deg, #fff3c2 0%, #ffe095 100%);
  box-shadow:0 14px 32px rgba(0,0,0,.25), inset 0 0 0 2px rgba(0,0,0,.08);
}
.node.center .title{
  /* slightly larger and spaced lettering for the centre island title */
  font-size:20px;
  font-weight:800;
  letter-spacing:.8px;
  text-transform:uppercase;
  margin-bottom:4px;
  /* tropical gradient on the project title */
  background:linear-gradient(90deg,#00b4d8,#75e5b0);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
}
.subtitle{
  color:var(--muted);
  font-weight:600;
  font-size:12px;
  letter-spacing:.3px;
  margin-top:-4px;
}

.category .head{display:flex;align-items:baseline;gap:10px;margin-bottom:12px}
.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.1);
  color:var(--accent);
  background:rgba(84,197,113,.15);
  font-weight:700;
  letter-spacing:.3px;
  font-size:12px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.badge i{
  display:inline-block;
  width:8px;
  height:8px;
  border-radius:50%;
  background:currentColor;
  box-shadow:0 0 6px currentColor;
}

.chips{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
  transition:max-height .35s ease;
  overflow:hidden;
}
.chip{
  background:linear-gradient(145deg,#fff7dc,#f0e5bd);
  border:1px solid rgba(0,0,0,.1);
  border-radius:14px;
  padding:12px 14px;
  color:var(--text);
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  cursor:default;
  box-shadow:0 2px 8px rgba(0,0,0,.05);
}
.chip .label{
  font-weight:700;
}
.chip .info{
  color:var(--muted);
  font-size:12px;
}

.toggle{
  position:absolute;
  top:14px;
  right:14px;
  width:28px;
  height:28px;
  border-radius:8px;
  display:grid;
  place-items:center;
  cursor:pointer;
  border:1px solid rgba(0,0,0,.1);
  background:rgba(255,255,255,.4);
  color:var(--text);
  font-weight:900;
  transition:.2s;
}
.toggle:hover{transform:translateY(-1px)}

svg.lines{position:absolute;inset:0;pointer-events:none}
.link{stroke:var(--stroke);stroke-width:2;fill:none;stroke-linecap:round}
.link.accent{stroke:url(#gradAccent)}
.draw{stroke-dasharray:1000;stroke-dashoffset:1000;animation:draw 1.2s ease forwards}
@keyframes draw{to{stroke-dashoffset:0}}
.node,.chip{opacity:0;transform:translateY(8px);animation:up .5s ease forwards}
.node.center{animation:pop .5s cubic-bezier(.2,.9,.2,1.2) .1s forwards}
@keyframes up{to{opacity:1;transform:none}}
@keyframes pop{from{opacity:0;transform:translate(-50%,-4px) scale(.98)} to{opacity:1;transform:translate(-50%,0) scale(1)}}

.chip[data-tip]:hover::after{
  content:attr(data-tip);
  position:absolute;
  transform:translateY(-100%);
  margin-top:-6px;
  background:linear-gradient(145deg,#fff7da,#f2e5b8);
  color:var(--text);
  border:1px solid rgba(0,0,0,.1);
  border-radius:10px;
  padding:8px 12px;
  width:280px;
  box-shadow:0 4px 12px rgba(0,0,0,.15);
  z-index:10;
  font-size:12px;
}

.legend{
  position:fixed;
  left:16px;
  bottom:16px;
  z-index:40;
  color:var(--text);
  background:rgba(255,255,255,.65);
  border:1px solid rgba(0,0,0,.1);
  padding:10px 14px;
  border-radius:14px;
  backdrop-filter:blur(8px);
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}
.legend .dot{
  width:10px;
  height:10px;
  border-radius:50%;
  display:inline-block;
  margin-right:6px;
}
.legend small{
  color:var(--muted);
}

@media (max-width:1100px){.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:700px){.grid{grid-template-columns:1fr}.node.center{position:static;transform:none;margin:16px auto 0}}
</style>
</head>
<body>

<div class="toolbar">
  <button id="reset">Reset</button>
  <button id="collapse">Collapse all</button>
  <button id="expand">Expand all</button>
  <button id="export">Export PNG</button>
  <span class="hint">Tip: drag to pan, scroll to zoom, click ◱ to collapse a category.</span>
</div>

<div class="legend">
  <div><span class="dot" style="background:#75e5b0"></span> Strategic Streams</div>
  <div><span class="dot" style="background:#00b4d8"></span> Programs & Activations</div>
  <small>Lines animate on load; hover chips for details.</small>
</div>

<div class="viewport">
  <div class="canvas" id="canvas">
    <svg class="lines" id="lines" preserveAspectRatio="none">
      <defs>
        <linearGradient id="gradAccent" x1="0" x2="1" y1="0" y2="0">
          <!-- updated to match the new lush accent palette -->
          <stop offset="0%" stop-color="#00b4d8"/>
          <stop offset="100%" stop-color="#75e5b0"/>
        </linearGradient>
      </defs>
    </svg>

    <div class="node center" id="center">
      <div class="title">PROJECT FUSION</div>
      <div class="subtitle">Condensed Sales Playbook</div>
    </div>

    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
/* ==== DATA ==== */
const DATA = [
  {id:'promos',label:'Programs & Activations',color:'#6ee7ff',items:[
    {label:'On Ice Program', tip:'10% discount on slowest SKUs; exclude samples/returns.'},
    {label:'Happy Hour', tip:'Timed promos tied to local events.'},
    {label:'Unique Drops', tip:'Limited-release strains/merch.'},
    {label:'Boarding Pass Bonus', tip:'Extra AlpineIQ points; often free redemption.'},
    {label:'Blind Box Pickup', tip:'Surprise-box sales to move mixed inventory.'},
    {label:'Brand Wheel', tip:'Spin-the-wheel activations with vouchers.'},
    {label:'Go Pink', tip:'Ruby partnership for Breast Cancer Awareness.'},
    {label:'Needle in a Haystack', tip:'Hidden SKU unlocks bonus rewards.'}
  ]},
  {id:'events',label:'Events & Local',color:'#7af0c0',items:[
    {label:'Glass Shows', tip:'Celebrity glassblower events + drops.'},
    {label:'Seasonal / Local', tip:'Community tie-ins, sports promos.'}
  ]},
  {id:'analytics',label:'Analytics & Dashboards',color:'#7af0c0',items:[
    {label:'BEI', tip:'Brand strength index for SKUs.'},
    {label:'PPI & Sell-Through', tip:'Tracks pricing power & competitiveness.'},
    {label:'Customer Strength Score', tip:'With reconciliation & CRM cadence.'}
  ]},
  {id:'strategy',label:'Strategy & Enablement',color:'#7af0c0',items:[
    {label:'Sales Team Efficiency', tip:'Scores, leaderboards, recognition.'},
    {label:'Pre-Roll Strategy', tip:'Ruby dominance stabilizes categories.'},
    {label:'Accessory Strategy', tip:'Curated essentials, avoid low-value.'},
    {label:'Store Strategy', tip:'Event hubs vs volume engines.'}
  ]}
];

/* ==== HELPERS ==== */
const grid = document.getElementById('grid');
const linesSVG = document.getElementById('lines');
const center = document.getElementById('center');
const canvas = document.getElementById('canvas');

function el(tag, cls, html){
  const n = document.createElement(tag);
  if(cls) n.className = cls;
  if(html) n.innerHTML = html;
  return n;
}

function createCategory(col){
  const node = el('div','node category');
  node.dataset.category = col.id;

  const head = el('div','head');
  const badge = el('div','badge', `<i style="background:${col.color}"></i> ${col.label}`);
  head.appendChild(badge);
  node.appendChild(head);

  const toggle = el('button','toggle','◱');
  toggle.title = 'Collapse/Expand';
  node.appendChild(toggle);

  const chipsWrap = el('div','chips');
  col.items.forEach((it,i)=>{
    const chip = el('div','chip');
    chip.style.animationDelay = `${0.05*i+0.1}s`;
    chip.dataset.tip = it.tip;
    chip.innerHTML = `<span class="label">${it.label}</span><span class="info">info</span>`;
    chipsWrap.appendChild(chip);
  });
  node.appendChild(chipsWrap);

  let open = true;
  const fullHeight = () => {
    chipsWrap.style.maxHeight = 'unset';
    const h = chipsWrap.getBoundingClientRect().height;
    chipsWrap.style.maxHeight = h + 'px';
    requestAnimationFrame(()=>{ chipsWrap.style.maxHeight = h + 'px'; });
  };
  const collapse = () => { chipsWrap.style.maxHeight = '0px'; open=false; };
  const expand = () => { fullHeight(); open=true; };
  toggle.addEventListener('click', ()=> open ? collapse() : expand());
  requestAnimationFrame(fullHeight);

  return {node, chipsWrap, toggle};
}

const catNodes = DATA.map(createCategory);
catNodes.forEach((c, i) => {
  // assign an island silhouette based on its index
  c.node.classList.add(`island-${i % 4}`);
  grid.appendChild(c.node);
});

/* ==== CONNECTORS ==== */
function pathBetween(a, b){
  const ra = a.getBoundingClientRect();
  const rb = b.getBoundingClientRect();
  const pa = {x: ra.left + ra.width/2 + window.scrollX, y: ra.bottom + window.scrollY};
  const pb = {x: rb.left + rb.width/2 + window.scrollX, y: rb.top + window.scrollY};
  const c1 = {x: pa.x, y: pa.y + 40};
  const c2 = {x: pb.x, y: pb.y - 40};
  return `M ${pa.x},${pa.y} C ${c1.x},${c1.y} ${c2.x},${c2.y} ${pb.x},${pb.y}`;
}
function drawLines(){
  const rect = canvas.getBoundingClientRect();
  linesSVG.setAttribute('viewBox', `0 0 ${rect.width} ${rect.height}`);
  linesSVG.setAttribute('width', rect.width);
  linesSVG.setAttribute('height', rect.height);
  linesSVG.querySelectorAll('path').forEach(p=>p.remove());
  catNodes.forEach((cat,i)=>{
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', pathBetween(center, cat.node));
    p.setAttribute('class','link accent draw');
    p.style.animationDelay = (i*0.08)+'s';
    linesSVG.appendChild(p);
  });
}
window.addEventListener('resize', drawLines);
new ResizeObserver(drawLines).observe(grid);
setTimeout(drawLines, 120);

/* ==== PAN & ZOOM ==== */
let scale = 1, origin = {x:0,y:0}, isPanning=false, start={x:0,y:0}, startOrigin={x:0,y:0};
function applyTransform(){
  canvas.style.transform = `translate(${origin.x}px, ${origin.y}px) scale(${scale})`;
  drawLines();
}
document.addEventListener('wheel', (e)=>{
  if(!e.ctrlKey && !e.metaKey){
    const delta = -e.deltaY * 0.0015;
    const prev = scale;
    scale = Math.min(2.0, Math.max(0.6, scale*(1+delta)));
    const rect = canvas.getBoundingClientRect();
    const px = e.clientX - rect.left, py = e.clientY - rect.top;
    origin.x -= (px/prev - px/scale);
    origin.y -= (py/prev - py/scale);
    applyTransform();
    e.preventDefault();
  }
},{passive:false});
canvas.addEventListener('pointerdown', (e)=>{
  isPanning = true;
  start = {x:e.clientX, y:e.clientY};
  startOrigin = {...origin};
  canvas.setPointerCapture(e.pointerId);
  // disable transition while dragging so movement feels instantaneous
  canvas.style.transition = 'none';
});
canvas.addEventListener('pointermove', (e)=>{
  if(!isPanning) return;
  origin.x = startOrigin.x + (e.clientX - start.x);
  origin.y = startOrigin.y + (e.clientY - start.y);
  applyTransform();
});
canvas.addEventListener('pointerup', ()=>{
  isPanning = false;
  // re‑enable smooth transform when user releases
  canvas.style.transition = 'transform .4s ease';
});

/* ==== CONTROLS ==== */
document.getElementById('reset').onclick = ()=>{
  scale=1; origin={x:0,y:0}; applyTransform();
};
document.getElementById('collapse').onclick = ()=>{
  document.querySelectorAll('.chips').forEach(c=> c.style.maxHeight='0px');
};
document.getElementById('expand').onclick = ()=>{
  document.querySelectorAll('.category .chips').forEach(c=>{
    c.style.maxHeight='unset';
    const h = c.getBoundingClientRect().height;
    c.style.maxHeight = h+'px';
  });
};

/* ==== EXPORT PNG ==== */
document.getElementById('export').onclick = async () => {
  const target = canvas;
  const prevTransform = target.style.transform;
  const prevScale = scale, prevOrigin = {...origin};
  scale = 1; origin = {x:0,y:0};
  target.style.transform = 'translate(0px,0px) scale(1)';
  drawLines();
  const shot = await html2canvas(target, {
    backgroundColor: '#0f1221',
    scale: 2,
    useCORS: true,
    windowWidth: target.getBoundingClientRect().width,
    windowHeight: target.getBoundingClientRect().height
  });
  scale = prevScale; origin = prevOrigin; target.style.transform = prevTransform; drawLines();
  const link = document.createElement('a');
  link.download = `project-fusion-flowchart-${new Date().toISOString().slice(0,10)}.png`;
  link.href = shot.toDataURL('image/png');
  link.click();
};

/* ==== STAGGER ENTRANCE ==== */
[...document.querySelectorAll('.node.category')].forEach((n,i)=>{
  n.style.animationDelay = `${0.1 + i*0.06}s`;
});
</script>
</body>
</html>
