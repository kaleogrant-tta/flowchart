<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PROJECT FUSION — Flowchart</title>

<!-- html2canvas for PNG export -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
/* =========================================================================
 * Lucidchart‑inspired flowchart theme
 *
 * This stylesheet discards the previous design and rebuilds the flowchart
 * from the ground up to echo the look of Lucidchart templates.  Lucidchart
 * recommends limiting the palette to just a few complementary colours to
 * keep diagrams readable【950328073522388†L213-L217】.  We therefore define
 * three category hues and reuse one to stay within that limit.  Shapes are
 * kept simple with subtle shadows and generous spacing for clarity.  A
 * distinct “start” terminator sits at the top of the canvas, connected by
 * straight lines with arrowheads to each category below.
 * ========================================================================= */

/* Colour palette – two unique hues reused across categories plus a third */
:root {
  --cat1: #5B9BD5;   /* sky blue – used for Programs & Activations and Strategy */
  --cat2: #A9D18E;   /* light green – used for Events & Local */
  --cat3: #FFD966;   /* pale yellow – used for Analytics & Dashboards */
  --start: #C0C0C0;  /* grey for start terminator */
  --bg: #FFFFFF;     /* white background for maximal contrast */
  --text: #333333;   /* dark text for readability */
  --border: #DDDDDD; /* light border */
  --shadow: 0 2px 4px rgba(0,0,0,0.1);
  --radius: 10px;
}

html, body {
  height: 100%;
}
body {
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  overflow: hidden;
  line-height: 1.4;
}

/* Toolbar positioned top right with minimal styling */
.toolbar {
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 100;
  display: flex;
  gap: 6px;
  align-items: center;
}
.toolbar button {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 5px 10px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text);
  box-shadow: var(--shadow);
  cursor: pointer;
  transition: background-color 0.2s ease;
}
.toolbar button:hover {
  background: #F5F5F5;
}
.toolbar .hint {
  font-size: 12px;
  color: #666;
  max-width: 240px;
}

/* Legend at bottom left explaining colour coding */
.legend {
  position: fixed;
  bottom: 12px;
  left: 12px;
  z-index: 90;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 5px;
  padding: 10px 12px;
  box-shadow: var(--shadow);
  font-size: 13px;
}
.legend .row {
  display: flex;
  align-items: center;
  margin-bottom: 4px;
}
.legend .row:last-child {
  margin-bottom: 0;
}
.legend .dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 6px;
}
.legend small {
  display: block;
  margin-top: 6px;
  color: #777;
}

/* Viewport and canvas support panning and zooming */
.viewport {
  position: fixed;
  inset: 0;
  overflow: hidden;
}
.canvas {
  position: absolute;
  inset: 0;
  transform-origin: 0 0;
  transition: transform 0.4s ease;
}

/* Layout container for categories */
.grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 60px;
  padding: 220px 20px 200px;
  max-width: 1200px;
  margin: 0 auto;
}

/* Generic node styling */
.node {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  width: 280px;
  display: flex;
  flex-direction: column;
  position: relative;
}

/* Start node (terminator) positioned at top centre */
.node.start {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 320px;
  border-radius: 20px;
  background: var(--start);
  border: 1px solid var(--border);
  box-shadow: var(--shadow);
  text-align: center;
  padding: 16px;
  font-weight: 600;
  color: var(--text);
}

/* Category node header */
.node .header {
  padding: 10px 12px;
  color: var(--bg);
  font-weight: 700;
  border-top-left-radius: var(--radius);
  border-top-right-radius: var(--radius);
  position: relative;
}
/* Chips container with collapsible behaviour */
.chips {
  padding: 0 12px 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}
.node.open .chips {
  max-height: 600px;
}
/* Chip styling */
.chip {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #F7F9FB;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 10px;
  font-size: 14px;
  color: var(--text);
  cursor: default;
  position: relative;
}
.chip .info {
  font-size: 12px;
  color: #888;
}

/* Tooltip for chip descriptions */
.chip[data-tip]:hover::after {
  content: attr(data-tip);
  position: absolute;
  left: 50%;
  transform: translateX(-50%) translateY(-100%);
  margin-top: -6px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 4px;
  padding: 6px 8px;
  color: var(--text);
  font-size: 12px;
  box-shadow: var(--shadow);
  white-space: normal;
  max-width: 200px;
  z-index: 10;
}

/* Toggle button for collapsing category lists */
.toggle {
  position: absolute;
  top: 6px;
  right: 6px;
  width: 24px;
  height: 24px;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: #F8F8F8;
  display: grid;
  place-items: center;
  cursor: pointer;
  font-weight: bold;
  color: var(--text);
  font-size: 16px;
  transition: background-color 0.2s ease;
}
.toggle:hover {
  background: #EEEEEE;
}

/* SVG container for connectors */
svg.lines {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
.link {
  stroke: #999999;
  stroke-width: 2;
  fill: none;
  marker-end: url(#arrowhead);
  opacity: 0;
  animation: fadeIn 0.5s forwards;
}
@keyframes fadeIn { to { opacity: 1; } }

/* Responsive: stack categories vertically on narrow screens */
@media (max-width: 700px) {
  .grid {
    flex-direction: column;
    align-items: center;
    gap: 40px;
  }
  .node {
    width: 90%;
  }
}
</style>
</head>
<body>

<div class="toolbar">
  <button id="reset">Reset</button>
  <button id="collapse">Collapse all</button>
  <button id="expand">Expand all</button>
  <button id="export">Export PNG</button>
  <span class="hint">Tip: drag to pan, scroll to zoom, click the ± button to collapse or expand a category.</span>
</div>

<div class="legend">
  <div class="row"><span class="dot" style="background:var(--cat1)"></span> Programs &amp; Activations</div>
  <div class="row"><span class="dot" style="background:var(--cat2)"></span> Events &amp; Local</div>
  <div class="row"><span class="dot" style="background:var(--cat3)"></span> Analytics &amp; Dashboards</div>
  <div class="row"><span class="dot" style="background:var(--cat1)"></span> Strategy &amp; Enablement</div>
  <small>Hover items for details; drag to pan and scroll to zoom.</small>
</div>

<div class="viewport">
  <div class="canvas" id="canvas">
    <svg class="lines" id="lines" preserveAspectRatio="none">
      <defs>
        <!-- Arrowhead marker used for connector endpoints -->
        <marker id="arrowhead" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 Z" fill="#999999"></path>
        </marker>
      </defs>
    </svg>

    <div class="node start" id="start">
      PROJECT&nbsp;FUSION<br><small>Condensed&nbsp;Sales&nbsp;Playbook</small>
    </div>

    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
/* ==== DATA ==== */
const DATA = [
  {id:'promos',label:'Programs & Activations',color:'var(--cat1)',items:[
    {label:'On Ice Program', tip:'10% discount on slowest SKUs; exclude samples/returns.'},
    {label:'Happy Hour', tip:'Timed promos tied to local events.'},
    {label:'Unique Drops', tip:'Limited-release strains/merch.'},
    {label:'Boarding Pass Bonus', tip:'Extra AlpineIQ points; often free redemption.'},
    {label:'Blind Box Pickup', tip:'Surprise-box sales to move mixed inventory.'},
    {label:'Brand Wheel', tip:'Spin-the-wheel activations with vouchers.'},
    {label:'Go Pink', tip:'Ruby partnership for Breast Cancer Awareness.'},
    {label:'Needle in a Haystack', tip:'Hidden SKU unlocks bonus rewards.'}
  ]},
  {id:'events',label:'Events & Local',color:'var(--cat2)',items:[
    {label:'Glass Shows', tip:'Celebrity glassblower events + drops.'},
    {label:'Seasonal / Local', tip:'Community tie-ins, sports promos.'}
  ]},
  {id:'analytics',label:'Analytics & Dashboards',color:'var(--cat3)',items:[
    {label:'BEI', tip:'Brand strength index for SKUs.'},
    {label:'PPI & Sell-Through', tip:'Tracks pricing power & competitiveness.'},
    {label:'Customer Strength Score', tip:'With reconciliation & CRM cadence.'}
  ]},
  {id:'strategy',label:'Strategy & Enablement',color:'var(--cat1)',items:[
    {label:'Sales Team Efficiency', tip:'Scores, leaderboards, recognition.'},
    {label:'Pre-Roll Strategy', tip:'Ruby dominance stabilizes categories.'},
    {label:'Accessory Strategy', tip:'Curated essentials, avoid low-value.'},
    {label:'Store Strategy', tip:'Event hubs vs volume engines.'}
  ]}
];

/* ==== HELPERS ==== */
const grid = document.getElementById('grid');
const linesSVG = document.getElementById('lines');
const center = document.getElementById('start');
const canvas = document.getElementById('canvas');

function el(tag, cls, html){
  const n = document.createElement(tag);
  if(cls) n.className = cls;
  if(html) n.innerHTML = html;
  return n;
}

function createCategory(col){
  const node = el('div', 'node category');
  node.dataset.category = col.id;

  // Coloured header displaying the category label
  const header = el('div', 'header', col.label);
  header.style.background = col.color || 'var(--primary)';
  node.appendChild(header);

  // Toggle button (minus sign when open, plus when closed)
  const toggle = el('div', 'toggle', '–');
  toggle.title = 'Collapse/Expand';
  node.appendChild(toggle);

  // Container for chips
  const chipsWrap = el('div', 'chips');
  col.items.forEach((it) => {
    const chip = el('div', 'chip');
    chip.dataset.tip = it.tip;
    chip.innerHTML = `<span class="label">${it.label}</span><span class="info">info</span>`;
    chipsWrap.appendChild(chip);
  });
  node.appendChild(chipsWrap);

  // Expand/collapse logic
  let open = true;
  const setHeight = () => {
    chipsWrap.style.maxHeight = 'unset';
    const h = chipsWrap.getBoundingClientRect().height;
    chipsWrap.style.maxHeight = h + 'px';
    requestAnimationFrame(() => { chipsWrap.style.maxHeight = h + 'px'; });
  };
  const collapse = () => {
    chipsWrap.style.maxHeight = '0px';
    open = false;
    toggle.textContent = '+';
  };
  const expand = () => {
    setHeight();
    open = true;
    toggle.textContent = '–';
  };
  toggle.addEventListener('click', () => (open ? collapse() : expand()));
  requestAnimationFrame(setHeight);

  return { node, chipsWrap, toggle };
}

const catNodes = DATA.map(createCategory);
catNodes.forEach((c) => {
  // Append each category node to the grid.  Island silhouettes were removed for the clean theme.
  grid.appendChild(c.node);
});

/* ==== CONNECTORS ==== */
function pathBetween(a, b){
  // Compute bottom centre of the start node and top centre of the category
  const ra = a.getBoundingClientRect();
  const rb = b.getBoundingClientRect();
  const pa = { x: ra.left + ra.width / 2 + window.scrollX, y: ra.bottom + window.scrollY };
  const pb = { x: rb.left + rb.width / 2 + window.scrollX, y: rb.top + window.scrollY };
  // Use a stepped polyline: down from pa to mid‑y, over to pb.x, then down to pb.y.
  const midY = (pa.y + pb.y) / 2;
  return `M ${pa.x},${pa.y} L ${pa.x},${midY} L ${pb.x},${midY} L ${pb.x},${pb.y}`;
}
function drawLines(){
  const rect = canvas.getBoundingClientRect();
  linesSVG.setAttribute('viewBox', `0 0 ${rect.width} ${rect.height}`);
  linesSVG.setAttribute('width', rect.width);
  linesSVG.setAttribute('height', rect.height);
  linesSVG.querySelectorAll('path').forEach(p=>p.remove());
  catNodes.forEach((cat,i)=>{
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', pathBetween(center, cat.node));
    p.setAttribute('class', 'link');
    // Stagger the appearance slightly to guide the eye
    p.style.animationDelay = (i * 0.05) + 's';
    linesSVG.appendChild(p);
  });
}
window.addEventListener('resize', drawLines);
new ResizeObserver(drawLines).observe(grid);
setTimeout(drawLines, 120);

/* ==== PAN & ZOOM ==== */
let scale = 1, origin = {x:0,y:0}, isPanning=false, start={x:0,y:0}, startOrigin={x:0,y:0};
function applyTransform(){
  canvas.style.transform = `translate(${origin.x}px, ${origin.y}px) scale(${scale})`;
  drawLines();
}
document.addEventListener('wheel', (e)=>{
  if(!e.ctrlKey && !e.metaKey){
    const delta = -e.deltaY * 0.0015;
    const prev = scale;
    scale = Math.min(2.0, Math.max(0.6, scale*(1+delta)));
    const rect = canvas.getBoundingClientRect();
    const px = e.clientX - rect.left, py = e.clientY - rect.top;
    origin.x -= (px/prev - px/scale);
    origin.y -= (py/prev - py/scale);
    applyTransform();
    e.preventDefault();
  }
},{passive:false});
canvas.addEventListener('pointerdown', (e)=>{
  // Avoid starting a pan when clicking on interactive elements like toggles or chips
  if (e.target.closest('.toggle') || e.target.closest('.chip') || e.target.closest('.header')) return;
  isPanning = true;
  start = { x: e.clientX, y: e.clientY };
  startOrigin = { ...origin };
  canvas.setPointerCapture(e.pointerId);
  // disable transition while dragging so movement feels instantaneous
  canvas.style.transition = 'none';
});
canvas.addEventListener('pointermove', (e)=>{
  if(!isPanning) return;
  origin.x = startOrigin.x + (e.clientX - start.x);
  origin.y = startOrigin.y + (e.clientY - start.y);
  applyTransform();
});
canvas.addEventListener('pointerup', ()=>{
  isPanning = false;
  // re‑enable smooth transform when user releases
  canvas.style.transition = 'transform .4s ease';
});

/* ==== CONTROLS ==== */
document.getElementById('reset').onclick = ()=>{
  scale=1; origin={x:0,y:0}; applyTransform();
};
document.getElementById('collapse').onclick = () => {
  // Only collapse category panels, leave the central node intact
  document.querySelectorAll('.category .chips').forEach(c => c.style.maxHeight = '0px');
};
document.getElementById('expand').onclick = ()=>{
  document.querySelectorAll('.category .chips').forEach(c=>{
    c.style.maxHeight='unset';
    const h = c.getBoundingClientRect().height;
    c.style.maxHeight = h+'px';
  });
};

/* ==== EXPORT PNG ==== */
document.getElementById('export').onclick = async () => {
  const target = canvas;
  const prevTransform = target.style.transform;
  const prevScale = scale, prevOrigin = {...origin};
  scale = 1; origin = {x:0,y:0};
  target.style.transform = 'translate(0px,0px) scale(1)';
  drawLines();
  // Determine the diagram background colour from CSS variables to avoid dark fill.
  const bgCol = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim() || '#ffffff';
  const shot = await html2canvas(target, {
    backgroundColor: bgCol,
    scale: 2,
    useCORS: true,
    windowWidth: target.getBoundingClientRect().width,
    windowHeight: target.getBoundingClientRect().height
  });
  scale = prevScale; origin = prevOrigin; target.style.transform = prevTransform; drawLines();
  const link = document.createElement('a');
  link.download = `project-fusion-flowchart-${new Date().toISOString().slice(0,10)}.png`;
  link.href = shot.toDataURL('image/png');
  link.click();
};

/* ==== STAGGER ENTRANCE ==== */
[...document.querySelectorAll('.node.category')].forEach((n,i)=>{
  n.style.animationDelay = `${0.1 + i*0.06}s`;
});
</script>
</body>
</html>
